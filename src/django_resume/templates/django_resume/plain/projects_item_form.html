<div id="{{ plugin_name }}-item-{{ form.item_id }}" class="project-box stack stack-card">
  {#  This is a hidden form that will be submitted by the button below.#}
  <form
    id="{{ plugin_name }}-form-{{ form.item_id }}"
    class="stack-small"
    hx-post="{{ form.post_url }}"
    hx-target="#{{ plugin_name }}-item-{{ form.item_id }}"
    hx-swap="outerHTML"
  >
    <input data-field="id" type="hidden" name="id" value="{{ form.item_id }}">
    <input data-field="position" type="hidden" name="position" value="{{ form.position.value }}">
    <input type="hidden" data-field="url" name="url" value="{{ form.url.value }}">
    <input type="hidden" data-field="title" name="title" value="{{ form.title.value }}">
    <input type="hidden" data-field="badges" name="badges" value="{{ form.badges.value }}">
    <input type="hidden" data-field="description" name="description" value="{{ form.description.value }}">
  </form>
  <div>
    <h3 contenteditable="true" data-field="title">{{ form.title.value }}</h3>
    <span contenteditable="true" data-field="url">{{ form.url.value }}</span>
  </div>
  <div>
    {% for error in form.title.errors %}
      <p class="error">{{ error|escape }}</p>
    {% endfor %}
    {% for error in form.url.errors %}
      <p class="error">{{ error|escape }}</p>
    {% endfor %}
  </div>
  <p contenteditable="true" data-field="description">{{ form.description.value }}</p>
  {% for error in form.description.errors %}
    <p class="error">{{ error|escape }}</p>
  {% endfor %}
  {% if form.badges.value %}
    <ul id="project-badges-list" class="cluster cluster-list project-badges-list">
      <li contenteditable="true" data-field="badges" style="display: none;" id="hidden-project-badges-list">
        {{ form.badges_as_text }}
      </li>
      {% for skill in form.badges.value %}
        <li class="project-badge badge">
          <span class="project-badge-name badge-name">{{ skill|escape }}</span>
          <button class="delete-project-badge-button badge-delete-button" type="button">
            <svg class="edit-icon-small">
              <use href="#delete"></use>
            </svg>
          </button>
        </li>
      {% endfor %}
      <li>
        <input type="text" id="new-project-badge-input" placeholder="Add badge">
        <button id="add-project-badge-button" type="button">Add</button>
      </li>
    </ul>
  {% endif %}
  {% for error in form.badges.errors %}
    <p class="error">{{ error|escape }}</p>
  {% endfor %}
  <button id="{{ plugin_name }}-submit-item-{{ form.item_id }}" type="submit">
    <svg class="edit-icon-small">
      <use href="#ok"></use>
    </svg>  
  </button>
  <script>
      // Listen for htmx events to re-initialize when content is swapped
      document.body.addEventListener('htmx:afterSwap', function (evt) {
          console.log("target id: ", evt.detail.target.id, );
          if (
              evt.detail &&
              evt.detail.target &&
              (evt.detail.target.id === "{{ plugin_name }}-item-{{ form.item_id }}" ||
               evt.detail.target.id === "projects-grid")
          ) {
              console.log("adding event listeners for project badges!");
              initBadgesForm(
                  'project-badges-list',
                  'new-project-badge-input',
                  'add-project-badge-button',
                  'hidden-project-badges-list',
                  'project-badge-name',
                  'project-badge',
                  'delete-project-badge-button',
                  '{{ plugin_name }}-submit-item-{{ form.item_id }}'
              );
              if (document.getElementById("{{ plugin_name }}-submit-item-{{ form.item_id }}")) {
                  registerClickListenerForHiddenForm(
                      "{{ plugin_name }}-item-{{ form.item_id }}",
                      "{{ plugin_name }}-submit-item-{{ form.item_id }}",
                      "{{ plugin_name }}-form-{{ form.item_id }}",
                      "{{ form.item_id }}"
                  );
              }
          }
      });
  </script>
</div>
