<div id="project-{{ form.item_id }}" class="project-box stack stack-card">
  {#  This is a hidden form that will be submitted by the button below.#}
  <form
    id="form-project-{{ form.item_id }}"
    class="stack-small"
    hx-post="{{ form.post_url }}"
    hx-target="#project-{{ form.item_id }}"
    hx-swap="outerHTML"
  >
    <input data-field="id" type="hidden" name="id" value="{{ form.item_id }}">
    <input data-field="position" type="hidden" name="position" value="{{ form.position.value }}">
    <input type="hidden" data-field="title" name="title" value="{{ form.title.value }}">
    <input type="hidden" data-field="badges" name="badges" value="{{ form.badges.value }}">
    <input type="hidden" data-field="description" name="description" value="{{ form.description.value }}">
  </form>
  <div>
    <h3 contenteditable="true" data-field="title">{{ form.title.value }}</h3>
    <span contenteditable="true" data-field="url">{{ form.url.value }}</span>
  </div>
  <p contenteditable="true" data-field="description">{{ form.description.value }}</p>
  {% if form.badges.value %}
    <ul class="cluster cluster-list project-badges-list">
      <li contenteditable="true" data-field="badges">{{ form.badges.value }}</li>
    </ul>
  {% endif %}
  <button id="submit-projects-item-{{ form.item_id }}" type="submit">
    <svg class="edit-icon-small">
      <use href="#ok"></use>
    </svg>
  </button>
  <script>
      {#If then submit button is clicked, then collect all the data from the contenteditable elements#}
      {#and copy them to the hidden input fields in the form. Then submit the form using htmx.#}
      document.getElementById("submit-projects-item-{{ form.item_id }}").addEventListener("click", function (e) {
          const projectItem = document.getElementById("project-{{ form.item_id }}");
          const formElement = document.getElementById("form-project-{{ form.item_id }}");
          const editableElements = projectItem.querySelectorAll("[contenteditable=true]");
          const formValues = {"id": "{{ form.item_id }}"};
          editableElements.forEach((field) => {
              const fieldName = field.dataset.field;
              const fieldValue = field.textContent.trim();
              formValues[fieldName] = fieldValue;
              const hiddenInput = formElement.querySelector(`input[type="hidden"][data-field="${fieldName}"]`);
              if (hiddenInput) {
                  hiddenInput.value = fieldValue;
                  console.log("hiddenInput: ", fieldName, fieldValue);
              }
          });
          console.log("formValues: ", formValues);
          htmx.trigger(formElement, "submit");
      });
  </script>
</div>
